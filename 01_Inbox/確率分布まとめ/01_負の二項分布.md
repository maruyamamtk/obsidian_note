# 負の二項分布 (Negative Binomial Distribution)

#統計

## 概要

負の二項分布は、独立なベルヌーイ試行において、特定の成功回数に達するまでに発生する失敗の回数をモデル化する際に用いられる離散型確率分布です。特に、ポアソン分布では対応できない「過分散」のデータに適しています。

## 基本情報

- **種別**: 離散型
- **定義域**: {0, 1, 2, 3, ...}
- **パラメータ**: 
  - r（目標とする成功回数、正の実数）
  - p（各試行での成功確率、0 < p < 1）

## 数学的性質

### 確率質量関数 (PMF)
$$P(X = k) = \binom{k+r-1}{k} p^r (1-p)^k$$

ここで、rは目標とする成功回数、kはr回目の成功までに発生する失敗回数、pは各試行での成功確率です。

### 統計的性質

- **平均（期待値）**: $E[X] = \frac{r(1-p)}{p}$
- **分散**: $\text{Var}[X] = \frac{r(1-p)}{p^2}$
- **標準偏差**: $\sqrt{\frac{r(1-p)}{p^2}}$

## 特徴と性質

### 過分散への対応

負の二項分布の最も重要な特徴は、**過分散 (overdispersion)** を扱いやすいことです：

- **過分散**: 観測データの分散が期待値（平均）を大きく超える状態
- **ポアソン分布の制約**: 平均と分散が等しい（λ）
- **負の二項分布の柔軟性**: 分散 > 平均の状況を自然に捉える

### 分散と平均の関係
負の二項分布では：
$$\text{Var}[X] = E[X] + \frac{E[X]^2}{r}$$

これにより、分散が平均より大きくなる状況をモデル化できます。

### 数学的特性

- **再生性**: 負の二項分布は再生性を持ちません
- **極限**: r → ∞ のとき、ポアソン分布に収束

## 特殊ケース

### 幾何分布との関係
r = 1の場合、負の二項分布は幾何分布と同じになります：
$$\text{NegBin}(1, p) = \text{Geom}(p)$$

## モデリングへの応用

### 適用例

#### 生物学・医学分野
- **TCRクローン頻度**: 免疫細胞のクローン拡大データ
- **疾患発生**: 感染症の伝播モデル
- **遺伝子発現**: RNA-seqデータの解析

#### ビジネス・マーケティング
- **顧客行動**: 顧客の購入回数予測
- **ウェブ解析**: サイト訪問回数（過分散がある場合）
- **リピート購入**: 商品の再購入行動

#### 金融・リスク管理
- **取引回数**: 金融商品の取引頻度モデル
- **保険請求**: 請求件数の予測（過分散考慮）

### 使用場面の特徴

負の二項分布を選択すべき状況：
- データに過分散が見られる
- ポアソン分布の仮定（分散=平均）が適さない
- 非常に大きなばらつきを持つカウントデータ
- 一部の個体/クローンが極端に大きい値を示すデータ

## 他の分布との関係

- **幾何分布**: r=1の特殊ケース
- **ポアソン分布**: r→∞での極限
- **ベータ二項分布**: 異なる過分散モデル
- **ガンマポアソン混合**: 連続混合表現
	- ガンマ分布でサンプリングされた値λをパラメタにもつポアソン分布は、負の二項分布になる
	- 個人の特性を加味した購買回数のモデリングなどに使用

## パラメータ推定

### モーメント法
標本平均 $\bar{x}$ と標本分散 $s^2$ から：

$$\hat{p} = \frac{\bar{x}}{s^2}$$

$$\hat{r} = \frac{\bar{x}^2}{s^2 - \bar{x}}$$

## 計算例

### 例題
成功確率0.3で、3回成功するまでに2回失敗する確率は？

$$P(X = 2) = \binom{2+3-1}{2} (0.3)^3 (0.7)^2 = \binom{4}{2} \times 0.027 \times 0.49 \approx 0.079$$

## 実装例（概念的）

```python
from math import comb

def negative_binomial_pmf(k, r, p):
    """負の二項分布の確率質量関数"""
    return comb(k + r - 1, k) * (p ** r) * ((1 - p) ** k)

def negative_binomial_properties(r, p):
    """負の二項分布の統計的性質"""
    mean = r * (1 - p) / p
    variance = r * (1 - p) / (p ** 2)
    std = (variance) ** 0.5
    
    return {
        'mean': mean,
        'variance': variance,
        'std': std,
        'overdispersion_ratio': variance / mean
    }

def check_overdispersion_nbinom(data_mean, data_variance):
    """過分散の確認"""
    if data_variance > data_mean * 1.5:
        return "負の二項分布が適切"
    return "ポアソン分布で十分"
```

## 参考

詳細な参考文献については[[04_参考文献]]を参照してください。

## 関連項目

- [[01_幾何分布]]
- [[01_ポアソン分布]]
- [[02_ガンマ分布]]
- [[03_確率分布間の関係性]]
